---
title: 破解 Android 应用会员逻辑
date: 2025-06-03
categories: ["开发工具"]
tags: ["Android"]  # 这会被自动填充为对应的标签
---
> ⚠️ **免责声明：本教程仅供学习 Android 安全和逆向工程知识，请勿用于商业破解或任何违法行为。若用于非法目的，后果自负！**

## 🧰 工具准备

| 工具               | 说明                   | 下载地址                                                                                                            |
| ---------------- | -------------------- | --------------------------------------------------------------------------------------------------------------- |
| 🔹 Java JDK（8+）  | 用于运行 apktool 和签名 APK | [Oracle JDK](https://www.oracle.com/java/technologies/javase-downloads.html) 或 [OpenJDK](https://jdk.java.net/) |
| 🔹 Apktool       | 用于反编译 / 回编译 APK      | [Apktool 官网](https://ibotpeaches.github.io/Apktool/)                                                            |
| 🔹 Frida-dexdump | 用于动态脱壳               | [GitHub - frida-dexdump](https://github.com/hluwa/frida-dexdump)                                                |
| 🔹 Jadx GUI      | 将 APK 转换为 Java 源码    | [Jadx GitHub](https://github.com/skylot/jadx)                                                                   |
| 🔹 ADB 工具        | 安装 APK 到 Android 手机  | [Platform Tools](https://developer.android.com/studio/releases/platform-tools)                                  |


## 🔧 一、环境配置

### ✅ 配置 Java JDK 环境变量（以 JDK 17 为例）

1. 安装 JDK，假设路径为：`C:\Program Files\Java\jdk-17`
2. 打开系统环境变量设置：

    * 新建系统变量 `JAVA_HOME`，值为 JDK 路径：

      ```
      JAVA_HOME = C:\Program Files\Java\jdk-17
      ```
    * 编辑 `Path` 变量，添加：

      ```
      %JAVA_HOME%\bin
      ```
3. 验证是否配置成功：

```cmd
java -version
javac -version
```

### ✅ 配置 apktool 使用（推荐 CLI 方式）

1. 下载 `apktool_2.xx.jar` ，放到如 `F:\AndroidTools\apktool\` 中。
2. 新建 `apktool.bat` 内容如下：

```bat
@echo off
java -jar "%~dp0apktool_2.9.3.jar" %*
```

3. 添加到系统 Path 环境变量：

```bat
F:\AndroidTools\apktool\
```

4. 验证是否成功：

```cmd
apktool
```


### ✅ 使用 Frida 进行脱壳

1. 安装 frida：

```bash
pip3 install frida frida-tools frida-dexdump
```

2. 下载 `frida-server`（版本根据目标 Android 系统和架构选择），例如 `frida-server-17.0.7-android-x86_64.xz`

3. 解压并放入 MuMu 模拟器 shell 目录（例如：`F:\MuMu Player 12\shell`），与 `adb.exe` 同目录。

4. 启动MuMu模拟器，连接 adb(我这个模拟器的端口是 7555,不同模拟器可能不一样)：

```bash
adb connect 127.0.0.1:7555
```

5. 设置为 root 权限：

```bash
adb root
```

6. 推送并设置执行权限：

将下载的frida-server-16.0.11-android-x86_64解压后放到mumu模拟器shell目录下，与adb同一目录，注意一定是解压后的

```bash
adb push frida-server-17.0.7-android-x86_64 /data/local/tmp/
adb shell chmod 755 /data/local/tmp/frida-server-17.0.7-android-x86_64
```

7. 启动 frida-server（注意使用管理员权限的 CMD）：

```bash
adb shell /data/local/tmp/frida-server-17.0.7-android-x86_64 &
```

若提示 `Permission denied`，说明模拟器未 root，可尝试使用可以root的模拟器

8. 获取当前运行中的应用的包名：

```bash
adb shell dumpsys window | findstr mCurrentFocus
```

## 🔍 二、使用 Jadx GUI 分析 VIP 逻辑

1. 启动 `jadx-gui.exe`，打开 APK 文件（如 `app.apk`）
2. 搜索以下关键词：

   ```
   isVip
   getIsVipVideo
   isPaid
   money
   pay_type
   ```
3. 找到核心 Java 方法，例如：

```java
public boolean getIsMoneyVideo() {
    return StringUtils.INSTANCE.isBiggerThan0(this.money);
}

public boolean getIsVipVideo() {
    return !getIsMoneyVideo() && TextUtils.equals(this.pay_type, "vip");
}
```

## 🛠 三、使用 apktool 修改 smali 实现

### 1. 反编译 APK：

```bash
apktool d app.apk -o app_src
```

### 2. 修改 smali 文件：

文件可能在如下路径：

```
app_src/smali*/com/xxx/xxx/bean/VideoItemBean.smali
```

将 `getIsVipVideo()` 方法替换为：

```smali
.method public getIsVipVideo()Z
    .locals 1
    const/4 v0, 0x1
    return v0
.end method
```

此修改表示该方法恒定返回 `true`，始终视为 VIP。


## 🧱 四、重新打包 APK

```bash
apktool b app_src -o modified_app.apk
```

## 🔏 五、生成签名密钥并签名 APK

### 1. 生成 keystore（仅需一次）

```bash
keytool -genkeypair -alias my-key-alias -keyalg RSA -keysize 2048 -validity 10000 \
 -keystore my-release-key.keystore -storepass 123456 -keypass 123456 \
 -dname "CN=Test, OU=Dev, O=Dev, L=City, ST=State, C=CN"
```

### 2. 使用 `jarsigner` 签名 APK

```bash
jarsigner -verbose -sigalg SHA256withRSA -digestalg SHA-256 \
 -keystore my-release-key.keystore -storepass 123456 \
 modified_app.apk my-key-alias
```

## 🚀 六、安装并测试

确保开启 USB 调试并连接设备：

```bash
adb install -r modified_app.apk
```

打开 App，验证 VIP 功能是否破解成功。

## 🧩 常见问题 FAQ

| 问题                      | 解决方案                                          |
| ----------------------- | --------------------------------------------- |
| 安装失败：签名不合法              | 使用 `jarsigner` 重新签名 APK                       |
| 提示 SHA1 算法被禁用           | 改用 `SHA256withRSA` 签名算法                       |
| 找不到修改方法                 | 用 jadx 的“跳转到定义”功能精确定位，或搜索 smali 类名精确修改        |
| 修改无效                    | 检查是否修改了正确 smali 文件，是否重新打包、签名和安装成功             |
| frida 无法注入或报 SELinux 错误 | 尝试 root 设备或更换模拟器；也可用 Magisk 配置为 permissive 模式 |
