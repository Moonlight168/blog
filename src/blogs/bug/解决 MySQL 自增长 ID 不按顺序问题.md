---
title: '解决 MySQL 自增长 ID 不按顺序问题'
date: 2025-06-16
categories: ["BUG"]
tags: ["MySQL"]
---


在开发过程中，`AUTO_INCREMENT` 字段在数据库中通常用作主键，自增长的 `id` 是数据库表中非常常见的设计。然而，在一些情况下，我们可能会遇到 ID 不按顺序递增的问题。今天，我们将介绍如何解决这个问题，确保数据库中的 `id` 按照顺序自增长。

## 1. 问题描述

我们在使用 MyBatis-Plus 插入数据时，发现数据库中的 `id` 字段并没有按照预期的顺序自增长。这种情况往往发生在数据库的字段类型不正确，或者在修改表结构时没有正确更新自增长计数器。

## 2. 原因分析

### 1. **数据库字段类型不匹配**

在数据库中，`id` 字段的类型如果设为 `INT`，在数据量达到一定值后，会导致溢出问题。而如果 `id` 字段的值超出了 `INT` 的最大范围，就会导致插入数据时失败。为避免这一问题，应该使用 `BIGINT` 类型。

### 2. **未给id字段设置 @TableId(type = IdType.AUTO)(PS:这是我的原因)**

### 3. **未重置自增长值**

在某些情况下，删除数据或重建表后，数据库的自增长计数器可能会出现不连续的情况，导致新的 `id` 值跳跃。通过重置自增长计数器，可以确保 `id` 从预期的值开始增长。

## 3. 解决方案

### 1. **修改数据库字段类型为 `BIGINT`**

确保数据库中的 `id` 字段类型为 `BIGINT`，以支持更大的数据范围。可以使用以下 SQL 语句修改字段类型：

```sql
ALTER TABLE notice MODIFY COLUMN id BIGINT AUTO_INCREMENT;
```

这样可以避免 `INT` 类型导致的数据溢出问题，确保 `id` 字段的自增长顺利进行。

### 2. **设置 `AUTO_INCREMENT` 起始值**

如果你希望自增长的 `id` 从某个特定值开始（比如 `11`），可以通过以下 SQL 设置起始值：

```sql
ALTER TABLE notice AUTO_INCREMENT = 11;
```

### 3. **检查当前 `AUTO_INCREMENT` 值**

如果你不确定当前自增长计数器的值，可以通过以下命令检查：

```sql
SHOW TABLE STATUS LIKE 'notice';
```

这将返回一个包含表状态信息的结果，其中包括当前的 `AUTO_INCREMENT` 值。在查看此值后，您可以确认自增长计数器是否设置正确。

### 4. **确保 PO 实体类 `id` 为自增长**

在 MyBatis-Plus 中，确保实体类的主键 `id` 被设置为自增长。你可以通过在实体类中使用 `@TableId(type = IdType.AUTO)` 注解来实现这一点。示例如下：

```java
@TableId(type = IdType.AUTO)
private Long id;
```

这将告知 MyBatis-Plus 在插入数据时，自动生成 `id` 值，而不需要手动设置。

### 5. **删除数据后的自增长值重置**

如果在删除数据后发现自增长计数器没有更新，导致后续插入的 `id` 跳跃，可以使用以下 SQL 命令来重置自增长值：

```sql
ALTER TABLE notice AUTO_INCREMENT = 1;  -- 设置起始值为 1
```

注意，这将使得自增长计数器从 `1` 开始，确保 `id` 从预期值递增。

## 4. 结论

确保数据库表中的 `id` 字段类型为 `BIGINT`，避免超出 `INT` 范围导致的问题。同时，合理配置 `AUTO_INCREMENT` 起始值，确保自增长计数器从正确的位置开始。通过 MyBatis-Plus 的 `@TableId(type = IdType.AUTO)` 注解，能够保证 `id` 字段的自增长行为，并且在删除数据后，适时重置自增长值，可以避免 ID 跳跃。

通过这些操作，能够有效解决 `id` 不按顺序递增的问题，确保数据库操作的稳定性和数据一致性。
