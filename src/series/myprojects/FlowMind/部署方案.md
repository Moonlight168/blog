---
title: "部署方案"
icon: /assets/icon/部署.png
order: 9
---

# 1. 进入根目录（确保在 / 下操作）
cd /

# 2. 创建核心目录（与 docker-compose 挂载路径对应）
sudo mkdir -p flowmind/{scripts,infra/docker,redis/data,postgres/data,prometheus/data,grafana/data,nacos/{data,logs},rocketmq/{namesrv/data,broker/{data,conf}},skywalking/oap/data}

# 3. 设置目录权限（避免容器读写权限不足）
sudo chmod -R 777 flowmind/

# 4. 验证目录结构（可选，确认创建成功）
tree /flowmind -L 3


| 组件名称               | 镜像版本                | 功能角色                     | 宿主机端口 | 数据存储路径（/flowmind/下）          | 核心环境变量/配置                     |
|------------------------|-------------------------|------------------------------|------------|---------------------------------------|---------------------------------------|
| PostgreSQL             | `postgres:16-alpine`    | 业务数据存储（用户、流程等） | 5432       | `postgres/data`                       | 数据库名：flowmind<br>用户名：flowmind_user<br>密码：flowmind_123 |
| Redis                  | `redis:7-alpine`        | 缓存（令牌、分布式锁）       | 6379       | `redis/data`                          | 密码：flowmind_redis123<br>开启持久化（appendonly yes） |
| Nacos                  | `nacos/nacos-server:v2.3.2` | 服务注册与配置中心           | 8848、9848、9849 | `nacos/data`（数据）<br>`nacos/log`（日志） | 模式：standalone（单机）<br>启用认证：true<br>令牌：flowmind_token |
| RocketMQ NameServer    | `apache/rocketmq:5.2.0`  | 消息队列路由服务             | 9876       | `rocketmq/namesrv/data`               | 依赖：无（独立服务）                  |
| RocketMQ Broker        | `apache/rocketmq:5.2.0`  | 消息队列 broker 服务         | 10911、10909、10912 | `rocketmq/broker/data`（数据）<br>`rocketmq/broker/conf`（配置） | 关联 NameServer：rocketmq-namesrv:9876<br>Broker IP：rocketmq-broker |
| SkyWalking OAP Server  | `apache/skywalking-oap-server:9.7.0` | 链路追踪数据处理中心         | 11800（gRPC）、12800（REST） | `skywalking/oap/data`                 | 存储：h2（内存数据库）<br>对接 Prometheus 监控 |
| SkyWalking UI          | `apache/skywalking-ui:9.7.0` | 链路追踪可视化界面           | 8088       | 无（依赖 OAP Server 数据）            | 关联 OAP：http://skywalking-oap:12800 |
| Prometheus             | `prom/prometheus:v2.45.0` | 指标采集与存储               | 9090       | `prometheus/data`（数据）<br>`prometheus/prometheus.yml`（配置） | 配置文件挂载：/flowmind/prometheus/prometheus.yml |
| Grafana                | `grafana/grafana:10.1.2` | 监控指标可视化仪表盘         | 3000       | `grafana/data`                        | 管理员账号：admin<br>管理员密码：admin123 |

### 补充说明
1. **版本选择逻辑**：所有组件均使用明确的版本号（非 `latest`），确保环境一致性，避免因自动更新导致兼容性问题。
2. **数据持久化**：通过 `volumes` 配置将所有组件数据映射到 `/flowmind` 目录下，便于统一管理和备份。
3. **网络通信**：所有组件接入 `flowmind-network` 自定义网络，可通过容器名直接通信（如 `nacos:8848`）。
