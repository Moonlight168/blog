---
title: "数据库设计"
icon: /assets/icon/data.png
order: 5
---
# FlowMind 系统数据库设计

## 1. 概述

本文档详细描述了FlowMind智能审批系统的数据库设计方案，包括表结构设计、字段定义、索引策略、数据类型选择以及扩展性考虑。数据库设计遵循数据库规范化原则，确保数据结构的合理性、完整性和可扩展性。

## 2. 设计原则

### 2.1 设计目标
- **数据完整性**：通过主键、外键、唯一约束等确保数据的一致性
- **结构清晰**：表结构清晰，便于理解和维护
- **可扩展性**：支持未来业务功能的扩展
- **性能优化**：合理的索引设计，支持高效查询
- **标准化**：遵循数据库设计范式，减少数据冗余

### 2.2 设计策略
- **无外键设计**：数据库层面不设置外键约束，所有关联关系由应用层维护
- **非严格3NF**：允许通过业务字段冗余来减少表关联，提高查询效率
- **逻辑删除优先**：所有表必须包含is_deleted字段，优先使用逻辑删除而非物理删除
- **业务字段冗余**：核心业务信息适当冗余，减少join操作
- **索引优化**：为逻辑删除字段和常用查询条件创建必要索引

### 2.2 命名规范
- **库名**：使用小写字母，长度1-8个字符，如 `flowmind`
- **表名**：使用小写字母，多个单词用下划线分隔，长度1-30个字符，如 `users`、`applications`
- **字段名**：使用小写字母，多个单词用下划线分隔，长度1-30个字符，如 `user_id`、`created_at`
- **临时表**：以 `tmp_` 为前缀，加日期后缀，如 `tmp_report_20241201`
- **主键**：统一使用 `id` 作为主键字段名
- **外键**：使用 `referenced_table_id` 格式，如 `user_id`、`dept_id`
- **索引**：使用 `idx_表名_字段名` 格式，如 `idx_users_email`
- **避免使用数据库保留字**：如 `order`、`group`、`user` 等
- **对象长度限制**：数据库名1-8字符，表名和字段名1-30字符

## 2.3 扩展数据字段设计

### 2.3.1 ext_data_json 字段说明

本系统在多个核心数据表中引入了 `ext_data_json` JSON类型字段，用于存储非结构化的扩展数据。这是一种有意识的设计决策，虽然在一定程度上打破了数据库的第一范式（1NF），但在现代微服务架构和快速迭代的业务环境中，这种设计带来了显著的优势。

### 2.3.2 使用理由与设计考量

1. **业务灵活性与扩展性**
   - 审批系统涉及多种不同类型的业务申请，每种申请可能需要不同的字段属性
   - 传统的关系型数据库设计需要预先定义所有可能的字段，难以应对动态变化的业务需求
   - JSON字段允许在不修改表结构的情况下动态添加、修改或删除扩展属性

2. **避免过度设计与表结构膨胀**
   - 如果为每一种业务场景都创建专门的字段，会导致表结构过度膨胀，难以维护
   - 许多业务属性只在特定场景下使用，为其创建单独字段会导致大量稀疏数据（NULL值）
   - JSON字段可以优雅地存储这些非核心的、场景特定的数据

3. **微服务架构适配性**
   - 在微服务架构下，不同服务可能对同一实体有不同的数据需求
   - JSON字段允许各服务独立管理其需要的扩展属性，减少服务间的耦合
   - 避免了跨服务修改表结构带来的协调成本和风险

4. **业务敏捷性与迭代速度**
   - 新业务需求往往需要快速上线，JSON字段允许前端和后端快速迭代，无需等待数据库迁移
   - 产品经理可以更灵活地设计表单和业务流程，而不受数据库结构的严格限制
   - 极大缩短了从需求提出到功能上线的时间周期

5. **数据查询与索引支持**
   - 现代数据库（如MySQL 8.0+）提供了对JSON字段的强大支持，包括JSON函数和JSON路径查询
   - 可以为JSON字段中的特定属性创建虚拟列或函数索引，兼顾灵活性和查询性能
   - 通过精心设计JSON结构，可以在保持灵活性的同时实现高效的数据访问

### 2.3.3 最佳实践

- **核心数据与扩展数据分离**：将频繁查询、需要严格约束的核心业务数据存储在常规字段中
- **JSON结构规范**：制定团队内部的JSON数据结构规范，避免数据格式混乱
- **性能考量**：对于需要频繁查询的JSON属性，考虑使用虚拟列或索引
- **版本管理**：在JSON内部维护版本信息，以便于未来的数据结构迁移和兼容性处理
- **适度使用**：不要将所有数据都放入JSON字段，只用于确实需要灵活扩展的场景

## 3. 主键设计说明

### 3.1 分布式ID策略

考虑到微服务架构需求，本系统采用**分布式ID生成策略**，确保跨服务数据唯一性。

#### 3.1.1 ID生成方案
- **雪花算法（Snowflake）**：64位长整型，包含时间戳、机器ID、序列号，作为主键ID
- **业务ID字段**：关键业务表增加`business_id`字段，用于用户可见的业务标识
- **内部ID**：主键`id`使用雪花算法生成的分布式ID，确保全局唯一性

#### 3.1.2 业务ID设计
- **申请相关表**：`applications`表增加`application_no`字段，格式：`APP{YYYYMMDD}{6位序列}`
- **审批相关表**：`approvals`表增加`approval_no`字段，格式：`APV{YYYYMMDD}{6位序列}`
- **用户可见**：业务ID用于前端展示、查询和业务流转
- **内部关联**：数据库关联仍使用分布式ID`id`

### 3.2 主键类型选择

| 特性 | 自增主键 | 分布式ID |
|------|--------|---------|
| **唯一性** | 单机唯一 | 全局唯一，分布式友好 |
| **性能** | 索引效率高，存储空间小 | 索引效率高，存储空间适中 |
| **可读性** | 较好，易于理解 | 业务ID可读性好 |
| **扩展性** | 单机扩展困难 | 天然支持分布式 |

**最终选择**：
- 主键`id`：使用雪花算法生成的分布式ID（BIGINT类型），确保跨服务全局唯一性
- 业务ID：关键业务表增加业务编号字段，用于用户可见的业务标识

## 4. 表结构设计

### 4.1 用户权限模块

#### 4.1.1 用户表 (users)

```sql
CREATE TABLE users (
    id BIGINT PRIMARY KEY COMMENT '用户ID (雪花算法生成的分布式ID)',
    username VARCHAR(50) NOT NULL UNIQUE COMMENT '用户名',
    password_hash VARCHAR(255) NOT NULL COMMENT '密码哈希',
    email VARCHAR(100) NOT NULL UNIQUE COMMENT '邮箱地址',
    phone VARCHAR(20) DEFAULT '' COMMENT '手机号码',
    real_name VARCHAR(50) DEFAULT '' COMMENT '真实姓名',
    dept_id BIGINT DEFAULT 0 COMMENT '部门ID',
    ext_data_json JSON COMMENT '扩展数据JSON',
    is_active BOOLEAN DEFAULT true COMMENT '是否激活',
    last_login_at DATETIME COMMENT '最后登录时间',
    created_by BIGINT DEFAULT 0 COMMENT '创建人ID',
    updated_by BIGINT DEFAULT 0 COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_users_username (username),
    INDEX idx_users_email (email),
    INDEX idx_users_dept_id (dept_id),
    INDEX idx_users_is_active (is_active),
    INDEX idx_users_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

**字段说明：**
- **id**：使用UUID作为主键，支持分布式部署
- **username**：用户登录名，唯一约束
- **password_hash**：使用bcrypt等安全算法加密的密码哈希
- **email**：用户邮箱，唯一约束，用于通知和密码找回
- **phone**：用户手机号，可选字段
- **real_name**：用户真实姓名，用于审批流程中的身份显示
- **dept_id**：关联到部门表的外键，支持用户所属部门
- **ext_data_json**：JSON字段，存储用户相关的扩展信息，如工号、职位等
- **is_active**：用户状态标志，支持逻辑删除
- **last_login_at**：记录用户最后登录时间，用于活跃度分析
- **created_by/updated_by**：记录操作人，支持操作审计
- **created_at/updated_at**：时间戳字段，支持数据追溯

#### 4.1.2 角色表 (roles)

```sql
CREATE TABLE roles (
    id BIGINT PRIMARY KEY COMMENT '角色ID (雪花算法生成的分布式ID)',
    role_name VARCHAR(50) NOT NULL UNIQUE COMMENT '角色名称',
    role_code VARCHAR(50) NOT NULL UNIQUE COMMENT '角色编码',
    description VARCHAR(255) DEFAULT '' COMMENT '角色描述',
    role_level INT DEFAULT 0 COMMENT '角色等级',
    ext_data_json JSON COMMENT '扩展数据JSON',
    is_deleted BOOLEAN DEFAULT false COMMENT '是否删除',
    created_by BIGINT DEFAULT 0 COMMENT '创建人ID',
    updated_by BIGINT DEFAULT 0 COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_roles_role_name (role_name),
    INDEX idx_roles_role_code (role_code),
    INDEX idx_roles_role_level (role_level),
    INDEX idx_roles_is_deleted (is_deleted)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='角色表';
```

#### 4.1.3 权限表 (permissions)

```sql
CREATE TABLE permissions (
    id BIGINT PRIMARY KEY COMMENT '权限ID (雪花算法生成的分布式ID)',
    permission_name VARCHAR(50) NOT NULL UNIQUE COMMENT '权限名称',
    permission_code VARCHAR(50) NOT NULL UNIQUE COMMENT '权限编码',
    description VARCHAR(255) DEFAULT '' COMMENT '权限描述',
    resource_type VARCHAR(50) DEFAULT '' COMMENT '资源类型',
    action VARCHAR(50) DEFAULT '' COMMENT '操作类型',
    ext_data_json JSON COMMENT '扩展数据JSON',
    is_deleted BOOLEAN DEFAULT false COMMENT '是否删除',
    created_by BIGINT DEFAULT 0 COMMENT '创建人ID',
    updated_by BIGINT DEFAULT 0 COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_permissions_permission_name (permission_name),
    INDEX idx_permissions_permission_code (permission_code),
    INDEX idx_permissions_resource_type (resource_type),
    INDEX idx_permissions_is_deleted (is_deleted)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='权限表';
```

#### 4.1.4 部门表 (departments)

```sql
CREATE TABLE departments (
    id BIGINT PRIMARY KEY COMMENT '部门ID (雪花算法生成的分布式ID)',
    dept_name VARCHAR(100) NOT NULL COMMENT '部门名称',
    dept_code VARCHAR(50) NOT NULL UNIQUE COMMENT '部门编码',
    parent_dept_id BIGINT DEFAULT 0 COMMENT '上级部门ID',
    dept_level INT DEFAULT 1 COMMENT '部门层级',
    description VARCHAR(255) DEFAULT '' COMMENT '部门描述',
    ext_data_json JSON COMMENT '扩展数据JSON',
    is_deleted BOOLEAN DEFAULT false COMMENT '是否删除',
    created_by BIGINT DEFAULT 0 COMMENT '创建人ID',
    updated_by BIGINT DEFAULT 0 COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_departments_dept_code (dept_code),
    INDEX idx_departments_parent_dept_id (parent_dept_id),
    INDEX idx_departments_dept_level (dept_level),
    INDEX idx_departments_is_deleted (is_deleted)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='部门表';
```

#### 4.1.5 用户角色关联表 (user_roles)

```sql
CREATE TABLE user_roles (
    id BIGINT PRIMARY KEY COMMENT '关联ID (雪花算法生成的分布式ID)',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    role_id BIGINT NOT NULL COMMENT '角色ID',
    created_by BIGINT DEFAULT 0 COMMENT '创建人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    
    UNIQUE KEY uk_user_roles_user_role (user_id, role_id),
    INDEX idx_user_roles_user_id (user_id),
    INDEX idx_user_roles_role_id (role_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户角色关联表';
```

#### 4.1.6 角色权限关联表 (role_permissions)

```sql
CREATE TABLE role_permissions (
    id BIGINT PRIMARY KEY COMMENT '关联ID (雪花算法生成的分布式ID)',
    role_id BIGINT NOT NULL COMMENT '角色ID',
    permission_id BIGINT NOT NULL COMMENT '权限ID',
    created_by BIGINT DEFAULT 0 COMMENT '创建人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    
    UNIQUE KEY uk_role_permissions_role_permission (role_id, permission_id),
    INDEX idx_role_permissions_role_id (role_id),
    INDEX idx_role_permissions_permission_id (permission_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='角色权限关联表';
```

### 4.2 申请流程模块

#### 4.2.1 申请表 (applications)

```sql
CREATE TABLE applications (
    id BIGINT PRIMARY KEY COMMENT '申请ID (雪花算法生成的分布式ID)',
    application_no VARCHAR(20) NOT NULL UNIQUE COMMENT '申请编号 (APP{YYYYMMDD}{6位序列})',
    user_id BIGINT NOT NULL COMMENT '申请人ID',
    application_type_id BIGINT NOT NULL COMMENT '申请类型ID',
    process_definition_id BIGINT NOT NULL COMMENT '流程定义ID',
    title VARCHAR(200) NOT NULL COMMENT '申请标题',
    content TEXT COMMENT '申请内容',
    amount DECIMAL(15,2) DEFAULT 0.00 COMMENT '申请金额',
    status VARCHAR(50) NOT NULL DEFAULT 'draft' COMMENT '申请状态',
    submitted_at DATETIME COMMENT '提交时间',
    updated_at DATETIME COMMENT '更新时间',
    current_node_id BIGINT DEFAULT 0 COMMENT '当前节点ID',
    ext_data_json JSON COMMENT '扩展数据JSON',
    is_deleted BOOLEAN DEFAULT false COMMENT '是否删除',
    is_cancelled BOOLEAN DEFAULT false COMMENT '是否撤销',
    cancel_reason VARCHAR(500) DEFAULT '' COMMENT '撤销原因',
    expected_completion_date DATE COMMENT '期望完成日期',
    priority VARCHAR(20) DEFAULT 'normal' COMMENT '优先级',
    created_by BIGINT DEFAULT 0 COMMENT '创建人ID',
    updated_by BIGINT DEFAULT 0 COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    
    INDEX idx_applications_application_no (application_no),
    INDEX idx_applications_user_id (user_id),
    INDEX idx_applications_application_type_id (application_type_id),
    INDEX idx_applications_process_definition_id (process_definition_id),
    INDEX idx_applications_status (status),
    INDEX idx_applications_submitted_at (submitted_at),
    INDEX idx_applications_current_node_id (current_node_id),
    INDEX idx_applications_priority (priority),
    INDEX idx_applications_created_at (created_at),
    FULLTEXT INDEX ft_applications_title_content (title, content)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='申请表';
```

#### 4.2.2 申请类型表 (application_types)

```sql
CREATE TABLE application_types (
    id BIGINT PRIMARY KEY COMMENT '申请类型ID (雪花算法生成的分布式ID)',
    type_name VARCHAR(100) NOT NULL UNIQUE COMMENT '类型名称',
    type_code VARCHAR(50) NOT NULL UNIQUE COMMENT '类型编码',
    description VARCHAR(500) DEFAULT '' COMMENT '类型描述',
    form_config_json JSON COMMENT '表单配置JSON',
    workflow_config_json JSON COMMENT '工作流配置JSON',
    ext_data_json JSON COMMENT '扩展数据JSON',
    is_active BOOLEAN DEFAULT true COMMENT '是否激活',
    created_by BIGINT DEFAULT 0 COMMENT '创建人ID',
    updated_by BIGINT DEFAULT 0 COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_application_types_type_name (type_name),
    INDEX idx_application_types_type_code (type_code),
    INDEX idx_application_types_is_active (is_active)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='申请类型表';
```

#### 4.2.3 流程定义表 (process_definitions)

```sql
CREATE TABLE process_definitions (
    id BIGINT PRIMARY KEY COMMENT '流程定义ID (雪花算法生成的分布式ID)',
    name VARCHAR(100) NOT NULL COMMENT '流程定义名称',
    code VARCHAR(50) NOT NULL UNIQUE COMMENT '流程定义编码',
    description TEXT COMMENT '流程定义描述',
    version VARCHAR(20) NOT NULL COMMENT '版本号',
    is_active BOOLEAN DEFAULT true COMMENT '是否启用',
    start_node_id BIGINT DEFAULT 0 COMMENT '开始节点ID',
    end_node_id BIGINT DEFAULT 0 COMMENT '结束节点ID',
    ext_data_json JSON COMMENT '扩展数据JSON',
    created_by BIGINT DEFAULT 0 COMMENT '创建人ID',
    updated_by BIGINT DEFAULT 0 COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME COMMENT '更新时间',
    
    INDEX idx_process_definitions_code (code),
    INDEX idx_process_definitions_is_active (is_active),
    INDEX idx_process_definitions_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='流程定义表';
```

#### 4.2.4 流程节点表 (process_nodes)

```sql
CREATE TABLE process_nodes (
    id BIGINT PRIMARY KEY COMMENT '流程节点ID (雪花算法生成的分布式ID)',
    process_definition_id BIGINT NOT NULL COMMENT '流程定义ID',
    node_name VARCHAR(100) NOT NULL COMMENT '节点名称',
    node_type VARCHAR(50) NOT NULL COMMENT '节点类型',
    node_code VARCHAR(50) NOT NULL COMMENT '节点编码',
    description TEXT COMMENT '节点描述',
    assignee_type VARCHAR(50) DEFAULT '' COMMENT '处理人类型',
    assignee_value VARCHAR(500) DEFAULT '' COMMENT '处理人值',
    form_config_json JSON COMMENT '表单配置JSON',
    action_config_json JSON COMMENT '动作配置JSON',
    condition_config_json JSON COMMENT '条件配置JSON',
    next_node_id BIGINT DEFAULT 0 COMMENT '下一节点ID',
    prev_node_id BIGINT DEFAULT 0 COMMENT '上一节点ID',
    sort_order INT DEFAULT 0 COMMENT '排序',
    is_start_node BOOLEAN DEFAULT false COMMENT '是否开始节点',
    is_end_node BOOLEAN DEFAULT false COMMENT '是否结束节点',
    timeout_minutes INT DEFAULT 0 COMMENT '超时时间(分钟)',
    ext_data_json JSON COMMENT '扩展数据JSON',
    created_by BIGINT DEFAULT 0 COMMENT '创建人ID',
    updated_by BIGINT DEFAULT 0 COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME COMMENT '更新时间',
    
    INDEX idx_process_nodes_process_definition_id (process_definition_id),
    INDEX idx_process_nodes_node_type (node_type),
    INDEX idx_process_nodes_node_code (node_code),
    INDEX idx_process_nodes_is_start_node (is_start_node),
    INDEX idx_process_nodes_is_end_node (is_end_node),
    INDEX idx_process_nodes_sort_order (sort_order),
    INDEX idx_process_nodes_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='流程节点表';
```

#### 4.2.5 审批表 (approvals)

```sql
CREATE TABLE approvals (
    id BIGINT PRIMARY KEY COMMENT '审批ID (雪花算法生成的分布式ID)',
    approval_no VARCHAR(20) NOT NULL UNIQUE COMMENT '审批编号 (APV{YYYYMMDD}{6位序列})',
    application_id BIGINT NOT NULL COMMENT '申请ID',
    process_node_id BIGINT NOT NULL COMMENT '流程节点ID',
    approver_id BIGINT NOT NULL COMMENT '审批人ID',
    approval_status VARCHAR(50) NOT NULL COMMENT '审批状态',
    approval_comment TEXT COMMENT '审批意见',
    approval_time DATETIME COMMENT '审批时间',
    is_auto_approved BOOLEAN DEFAULT false COMMENT '是否自动审批',
    ext_data_json JSON COMMENT '扩展数据JSON',
    created_by BIGINT DEFAULT 0 COMMENT '创建人ID',
    updated_by BIGINT DEFAULT 0 COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME COMMENT '更新时间',
    
    INDEX idx_approvals_approval_no (approval_no),
    INDEX idx_approvals_application_id (application_id),
    INDEX idx_approvals_process_node_id (process_node_id),
    INDEX idx_approvals_approver_id (approver_id),
    INDEX idx_approvals_approval_status (approval_status),
    INDEX idx_approvals_approval_time (approval_time),
    INDEX idx_approvals_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='审批表';
```

### 4.3 历史记录模块

#### 4.3.1 申请历史表 (application_histories)

```sql
CREATE TABLE application_histories (
    id BIGINT PRIMARY KEY COMMENT '历史ID (雪花算法生成的分布式ID)',
    application_id BIGINT NOT NULL COMMENT '申请ID',
    field_name VARCHAR(100) NOT NULL COMMENT '字段名称',
    old_value TEXT COMMENT '旧值',
    new_value TEXT COMMENT '新值',
    action_type VARCHAR(50) NOT NULL COMMENT '操作类型',
    ext_data_json JSON COMMENT '扩展数据JSON',
    changed_by BIGINT NOT NULL COMMENT '变更人ID',
    changed_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '变更时间',
    created_by BIGINT DEFAULT 0 COMMENT '创建人ID',
    updated_by BIGINT DEFAULT 0 COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME COMMENT '更新时间',
    
    INDEX idx_application_histories_application_id (application_id),
    INDEX idx_application_histories_field_name (field_name),
    INDEX idx_application_histories_action_type (action_type),
    INDEX idx_application_histories_changed_by (changed_by),
    INDEX idx_application_histories_changed_at (changed_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='申请历史表';
```

#### 4.3.2 审批历史表 (approval_histories)

```sql
CREATE TABLE approval_histories (
    id BIGINT PRIMARY KEY COMMENT '审批历史ID (雪花算法生成的分布式ID)',
    approval_id BIGINT NOT NULL COMMENT '审批ID',
    action VARCHAR(50) NOT NULL COMMENT '操作类型',
    action_comment TEXT COMMENT '操作说明',
    action_by BIGINT NOT NULL COMMENT '操作人ID',
    action_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '操作时间',
    ext_data_json JSON COMMENT '扩展数据JSON',
    created_by BIGINT DEFAULT 0 COMMENT '创建人ID',
    updated_by BIGINT DEFAULT 0 COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME COMMENT '更新时间',
    
    INDEX idx_approval_histories_approval_id (approval_id),
    INDEX idx_approval_histories_action (action),
    INDEX idx_approval_histories_action_by (action_by),
    INDEX idx_approval_histories_action_time (action_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='审批历史表';
```

#### 4.3.3 转交记录表 (transfer_records)

```sql
CREATE TABLE transfer_records (
    id BIGINT PRIMARY KEY COMMENT '转交记录ID (雪花算法生成的分布式ID)',
    approval_id BIGINT NOT NULL COMMENT '审批ID',
    from_user_id BIGINT NOT NULL COMMENT '转出人ID',
    to_user_id BIGINT NOT NULL COMMENT '接收人ID',
    transfer_reason TEXT COMMENT '转交原因',
    transferred_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '转交时间',
    ext_data_json JSON COMMENT '扩展数据JSON',
    created_by BIGINT DEFAULT 0 COMMENT '创建人ID',
    updated_by BIGINT DEFAULT 0 COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME COMMENT '更新时间',
    
    INDEX idx_transfer_records_approval_id (approval_id),
    INDEX idx_transfer_records_from_user_id (from_user_id),
    INDEX idx_transfer_records_to_user_id (to_user_id),
    INDEX idx_transfer_records_transferred_at (transferred_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='转交记录表';
```

### 4.4 辅助功能模块

#### 4.4.1 附件表 (attachments)

```sql
CREATE TABLE attachments (
    id BIGINT PRIMARY KEY COMMENT '附件ID (雪花算法生成的分布式ID)',
    application_id BIGINT NOT NULL COMMENT '申请ID',
    file_name VARCHAR(255) NOT NULL COMMENT '文件名称',
    file_path VARCHAR(500) NOT NULL COMMENT '文件路径',
    file_type VARCHAR(100) DEFAULT '' COMMENT '文件类型',
    file_size BIGINT DEFAULT 0 COMMENT '文件大小（字节）',
    hash_value VARCHAR(64) DEFAULT '' COMMENT '文件哈希值',
    ext_data_json JSON COMMENT '扩展数据JSON',
    uploaded_by BIGINT NOT NULL COMMENT '上传人ID',
    uploaded_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '上传时间',
    created_by BIGINT DEFAULT 0 COMMENT '创建人ID',
    updated_by BIGINT DEFAULT 0 COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME COMMENT '更新时间',
    
    INDEX idx_attachments_application_id (application_id),
    INDEX idx_attachments_uploaded_by (uploaded_by),
    INDEX idx_attachments_file_type (file_type),
    INDEX idx_attachments_uploaded_at (uploaded_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='附件表';
```

#### 4.4.2 通知表 (notifications)

```sql
CREATE TABLE notifications (
    id BIGINT PRIMARY KEY COMMENT '通知ID (雪花算法生成的分布式ID)',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    application_id BIGINT DEFAULT 0 COMMENT '申请ID',
    type VARCHAR(50) NOT NULL COMMENT '通知类型',
    title VARCHAR(200) NOT NULL COMMENT '通知标题',
    content TEXT COMMENT '通知内容',
    is_read BOOLEAN DEFAULT false COMMENT '是否已读',
    read_at DATETIME COMMENT '阅读时间',
    related_id BIGINT DEFAULT 0 COMMENT '关联ID',
    ext_data_json JSON COMMENT '扩展数据JSON',
    created_by BIGINT DEFAULT 0 COMMENT '创建人ID',
    updated_by BIGINT DEFAULT 0 COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME COMMENT '更新时间',
    
    INDEX idx_notifications_user_id (user_id),
    INDEX idx_notifications_application_id (application_id),
    INDEX idx_notifications_type (type),
    INDEX idx_notifications_is_read (is_read),
    INDEX idx_notifications_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='通知表';
```

#### 4.4.3 资源表 (resources)

```sql
CREATE TABLE resources (
    id BIGINT PRIMARY KEY COMMENT '资源ID (雪花算法生成的分布式ID)',
    dept_id BIGINT NOT NULL COMMENT '部门ID',
    resource_type VARCHAR(50) NOT NULL COMMENT '资源类型',
    resource_name VARCHAR(100) NOT NULL COMMENT '资源名称',
    quantity INT DEFAULT 0 COMMENT '总数量',
    available_quantity INT DEFAULT 0 COMMENT '可用数量',
    unit VARCHAR(20) DEFAULT '' COMMENT '单位',
    description VARCHAR(500) DEFAULT '' COMMENT '资源描述',
    ext_data_json JSON COMMENT '扩展数据JSON',
    is_active BOOLEAN DEFAULT true COMMENT '是否激活',
    created_by BIGINT DEFAULT 0 COMMENT '创建人ID',
    updated_by BIGINT DEFAULT 0 COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME COMMENT '更新时间',
    
    INDEX idx_resources_dept_id (dept_id),
    INDEX idx_resources_resource_type (resource_type),
    INDEX idx_resources_resource_name (resource_name),
    INDEX idx_resources_is_active (is_active)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='资源表';
```

#### 4.4.4 智能初审表 (intelligent_reviews)

```sql
CREATE TABLE intelligent_reviews (
    id BIGINT PRIMARY KEY COMMENT '初审ID (雪花算法生成的分布式ID)',
    application_id BIGINT NOT NULL COMMENT '申请ID',
    review_type VARCHAR(50) NOT NULL COMMENT '初审类型',
    review_result VARCHAR(20) NOT NULL COMMENT '初审结果',
    confidence_score DECIMAL(5,2) DEFAULT 0.00 COMMENT '置信度分数',
    review_rules_json JSON COMMENT '初审规则JSON',
    review_data_json JSON COMMENT '初审数据JSON',
    review_notes TEXT COMMENT '初审备注',
    is_active BOOLEAN DEFAULT true COMMENT '是否有效',
    created_by BIGINT DEFAULT 0 COMMENT '创建人ID',
    updated_by BIGINT DEFAULT 0 COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME COMMENT '更新时间',
    
    INDEX idx_intelligent_reviews_application_id (application_id),
    INDEX idx_intelligent_reviews_review_type (review_type),
    INDEX idx_intelligent_reviews_review_result (review_result),
    INDEX idx_intelligent_reviews_is_active (is_active)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='智能初审表';
```

## 5. 索引设计

### 5.1 索引设计原则

本项目遵循统一的数据库设计规范，具体索引设计原则请参考项目根目录下的《[数据库设计规范](..//数据库设计规范.md)》文件。

### 5.2 索引定义

```sql
-- 用户表索引
CREATE UNIQUE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_dept_id ON users(dept_id);
CREATE INDEX idx_users_status ON users(status);

-- 申请相关索引
CREATE INDEX idx_applications_user_id ON applications(user_id);
CREATE INDEX idx_applications_status ON applications(status);
CREATE INDEX idx_applications_type_id ON applications(application_type_id);
CREATE INDEX idx_applications_submitted_at ON applications(submitted_at);

-- 审批相关索引
CREATE INDEX idx_approvals_approver_id ON approvals(approver_id);
CREATE INDEX idx_approvals_status ON approvals(status);
CREATE INDEX idx_approvals_due_at ON approvals(due_at);

-- 通知相关索引
CREATE INDEX idx_notifications_user_id ON notifications(user_id);
CREATE INDEX idx_notifications_is_read ON notifications(is_read);
CREATE INDEX idx_notifications_created_at ON notifications(created_at);

-- 组合索引示例
CREATE INDEX idx_users_dept_status ON users(dept_id, status);
CREATE INDEX idx_applications_user_status ON applications(user_id, status);
CREATE INDEX idx_applications_type_status ON applications(application_type_id, status);
CREATE INDEX idx_approvals_approver_status ON approvals(approver_id, status);
```

## 6. 设计规范说明

本项目数据库设计遵循统一的《数据库设计规范》，该规范包含：

- 表结构设计规范
- 索引设计规范  
- 数据完整性与最佳实践
- 扩展性设计原则
- 性能优化考虑
- SQL与运维规范
- 安全性设计

详细规范内容请参考该栏目 [数据库设计规范](..//数据库设计规范.md)

本数据库设计为FlowMind智能审批系统提供了完整、灵活、可扩展的数据存储方案，能够支撑系统的核心业务功能，同时为未来的业务发展和技术演进预留了充分的扩展空间。