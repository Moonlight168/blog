---
order: 3
title: 数据库设计
category: 开发流程
icon: /assets/icon/database.png
---

# FlowMind 系统数据库设计

## 1. 概述

本文档详细描述了FlowMind智能审批系统的数据库设计方案，包括表结构设计、字段定义、索引策略、数据类型选择以及扩展性考虑。数据库设计遵循数据库规范化原则，确保数据结构的合理性、完整性和可扩展性。

## 2. 设计原则

### 2.1 设计目标
- **数据完整性**：通过主键、外键、唯一约束等确保数据的一致性
- **结构清晰**：表结构清晰，便于理解和维护
- **可扩展性**：支持未来业务功能的扩展
- **性能优化**：合理的索引设计，支持高效查询
- **标准化**：遵循数据库设计范式，减少数据冗余

### 2.2 命名规范
- **表名**：使用复数形式，小写字母，多个单词用下划线分隔，如 `users`、`applications`
- **字段名**：使用小写字母，多个单词用下划线分隔，如 `user_id`、`created_at`
- **主键**：统一使用 `id` 作为主键字段名
- **外键**：使用 `referenced_table_id` 格式，如 `user_id`、`dept_id`
- **索引**：使用 `idx_表名_字段名` 格式，如 `idx_users_email`

## 3. 主键设计说明

### 3.1 为什么使用UUID而不是BIGINT

在本系统中，我们选择使用UUID（36位字符串）作为主键，而不是传统的BIGINT自增主键，主要基于以下考虑：

#### 3.1.1 分布式架构支持
- **无中心化生成**：UUID可以在应用层生成，无需依赖数据库的自增机制，避免单点瓶颈
- **支持分库分表**：在分布式数据库架构中，UUID可以避免不同分片间的ID冲突
- **微服务友好**：微服务架构下，不同服务可以独立生成ID，无需协调

#### 3.1.2 数据安全性
- **不可预测性**：UUID是随机生成的，难以通过ID猜测数据量和业务规模
- **防止信息泄露**：自增ID容易暴露系统的业务活跃度，UUID则无法通过ID推断
- **支持数据脱敏**：在日志和外部接口中，UUID相对更安全

#### 3.1.3 业务灵活性
- **支持数据迁移**：在不同环境间迁移数据时，无需担心ID冲突
- **支持离线操作**：客户端可以在离线状态下生成ID，待联网后同步
- **支持批量导入**：批量导入数据时，无需担心ID重复问题

#### 3.1.4 性能考虑
- **索引性能**：虽然UUID比BIGINT占用更多存储空间（36字节 vs 8字节），但现代数据库对字符串索引优化良好
- **查询性能**：在适当的索引设计下，UUID的查询性能与BIGINT差异不大
- **存储成本**：额外的存储空间成本在现代硬件条件下可以接受

#### 3.1.5 适用场景
- **中等规模系统**：对于FlowMind这种中等规模的业务系统，UUID的性能影响在可接受范围内
- **B2B业务**：企业级应用对数据一致性和安全性要求更高，UUID的优势更加明显
- **长期演进**：为系统未来的分布式扩展预留空间，避免后期重构成本

## 4. 表结构设计

### 4.1 用户权限模块

#### 4.1.1 用户表 (users)

```sql
CREATE TABLE users (
    id VARCHAR(36) PRIMARY KEY COMMENT '用户ID (UUID)',
    username VARCHAR(50) NOT NULL UNIQUE COMMENT '用户名',
    password_hash VARCHAR(255) NOT NULL COMMENT '密码哈希',
    email VARCHAR(100) NOT NULL UNIQUE COMMENT '邮箱地址',
    phone VARCHAR(20) COMMENT '手机号码',
    real_name VARCHAR(50) COMMENT '真实姓名',
    dept_id VARCHAR(36) COMMENT '部门ID',
    ext_data_json JSON COMMENT '扩展数据JSON',
    is_active BOOLEAN DEFAULT true COMMENT '是否激活',
    last_login_at DATETIME COMMENT '最后登录时间',
    created_by VARCHAR(36) COMMENT '创建人ID',
    updated_by VARCHAR(36) COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_users_username (username),
    INDEX idx_users_email (email),
    INDEX idx_users_dept_id (dept_id),
    INDEX idx_users_is_active (is_active),
    INDEX idx_users_created_at (created_at),
    
    FOREIGN KEY (dept_id) REFERENCES departments(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

**字段说明：**
- **id**：使用UUID作为主键，支持分布式部署
- **username**：用户登录名，唯一约束
- **password_hash**：使用bcrypt等安全算法加密的密码哈希
- **email**：用户邮箱，唯一约束，用于通知和密码找回
- **phone**：用户手机号，可选字段
- **real_name**：用户真实姓名，用于审批流程中的身份显示
- **dept_id**：关联到部门表的外键，支持用户所属部门
- **ext_data_json**：JSON字段，存储用户相关的扩展信息，如工号、职位等
- **is_active**：用户状态标志，支持逻辑删除
- **last_login_at**：记录用户最后登录时间，用于活跃度分析
- **created_by/updated_by**：记录操作人，支持操作审计
- **created_at/updated_at**：时间戳字段，支持数据追溯

#### 4.1.2 角色表 (roles)

```sql
CREATE TABLE roles (
    id VARCHAR(36) PRIMARY KEY COMMENT '角色ID (UUID)',
    role_name VARCHAR(50) NOT NULL UNIQUE COMMENT '角色名称',
    role_code VARCHAR(50) NOT NULL UNIQUE COMMENT '角色编码',
    description VARCHAR(255) COMMENT '角色描述',
    role_level INT DEFAULT 0 COMMENT '角色等级',
    ext_data_json JSON COMMENT '扩展数据JSON',
    is_active BOOLEAN DEFAULT true COMMENT '是否激活',
    created_by VARCHAR(36) COMMENT '创建人ID',
    updated_by VARCHAR(36) COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_roles_role_name (role_name),
    INDEX idx_roles_role_code (role_code),
    INDEX idx_roles_role_level (role_level),
    INDEX idx_roles_is_active (is_active)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='角色表';
```

#### 4.1.3 权限表 (permissions)

```sql
CREATE TABLE permissions (
    id VARCHAR(36) PRIMARY KEY COMMENT '权限ID (UUID)',
    permission_name VARCHAR(50) NOT NULL UNIQUE COMMENT '权限名称',
    permission_code VARCHAR(50) NOT NULL UNIQUE COMMENT '权限编码',
    description VARCHAR(255) COMMENT '权限描述',
    resource_type VARCHAR(50) COMMENT '资源类型',
    action VARCHAR(50) COMMENT '操作类型',
    ext_data_json JSON COMMENT '扩展数据JSON',
    is_active BOOLEAN DEFAULT true COMMENT '是否激活',
    created_by VARCHAR(36) COMMENT '创建人ID',
    updated_by VARCHAR(36) COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_permissions_permission_name (permission_name),
    INDEX idx_permissions_permission_code (permission_code),
    INDEX idx_permissions_resource_type (resource_type),
    INDEX idx_permissions_is_active (is_active)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='权限表';
```

#### 4.1.4 部门表 (departments)

```sql
CREATE TABLE departments (
    id VARCHAR(36) PRIMARY KEY COMMENT '部门ID (UUID)',
    dept_name VARCHAR(100) NOT NULL COMMENT '部门名称',
    dept_code VARCHAR(50) NOT NULL UNIQUE COMMENT '部门编码',
    parent_dept_id VARCHAR(36) COMMENT '上级部门ID',
    dept_level INT DEFAULT 1 COMMENT '部门层级',
    description VARCHAR(255) COMMENT '部门描述',
    ext_data_json JSON COMMENT '扩展数据JSON',
    is_active BOOLEAN DEFAULT true COMMENT '是否激活',
    created_by VARCHAR(36) COMMENT '创建人ID',
    updated_by VARCHAR(36) COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_departments_dept_code (dept_code),
    INDEX idx_departments_parent_dept_id (parent_dept_id),
    INDEX idx_departments_dept_level (dept_level),
    INDEX idx_departments_is_active (is_active),
    
    FOREIGN KEY (parent_dept_id) REFERENCES departments(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='部门表';
```

#### 4.1.5 用户角色关联表 (user_roles)

```sql
CREATE TABLE user_roles (
    id VARCHAR(36) PRIMARY KEY COMMENT '关联ID (UUID)',
    user_id VARCHAR(36) NOT NULL COMMENT '用户ID',
    role_id VARCHAR(36) NOT NULL COMMENT '角色ID',
    created_by VARCHAR(36) COMMENT '创建人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    
    UNIQUE KEY uk_user_roles_user_role (user_id, role_id),
    INDEX idx_user_roles_user_id (user_id),
    INDEX idx_user_roles_role_id (role_id),
    
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户角色关联表';
```

#### 4.1.6 角色权限关联表 (role_permissions)

```sql
CREATE TABLE role_permissions (
    id VARCHAR(36) PRIMARY KEY COMMENT '关联ID (UUID)',
    role_id VARCHAR(36) NOT NULL COMMENT '角色ID',
    permission_id VARCHAR(36) NOT NULL COMMENT '权限ID',
    created_by VARCHAR(36) COMMENT '创建人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    
    UNIQUE KEY uk_role_permissions_role_permission (role_id, permission_id),
    INDEX idx_role_permissions_role_id (role_id),
    INDEX idx_role_permissions_permission_id (permission_id),
    
    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,
    FOREIGN KEY (permission_id) REFERENCES permissions(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='角色权限关联表';
```

### 4.2 申请流程模块

#### 4.2.1 申请表 (applications)

```sql
CREATE TABLE applications (
    id VARCHAR(36) PRIMARY KEY COMMENT '申请ID (UUID)',
    user_id VARCHAR(36) NOT NULL COMMENT '申请人ID',
    application_type_id VARCHAR(36) NOT NULL COMMENT '申请类型ID',
    process_definition_id VARCHAR(36) NOT NULL COMMENT '流程定义ID',
    title VARCHAR(200) NOT NULL COMMENT '申请标题',
    content TEXT COMMENT '申请内容',
    amount DECIMAL(15,2) COMMENT '申请金额',
    status VARCHAR(50) NOT NULL DEFAULT 'draft' COMMENT '申请状态',
    submitted_at DATETIME COMMENT '提交时间',
    updated_at DATETIME COMMENT '更新时间',
    current_node_id VARCHAR(36) COMMENT '当前节点ID',
    ext_data_json JSON COMMENT '扩展数据JSON',
    is_deleted BOOLEAN DEFAULT false COMMENT '是否删除',
    is_cancelled BOOLEAN DEFAULT false COMMENT '是否撤销',
    cancel_reason VARCHAR(500) COMMENT '撤销原因',
    expected_completion_date DATE COMMENT '期望完成日期',
    priority VARCHAR(20) DEFAULT 'normal' COMMENT '优先级',
    created_by VARCHAR(36) COMMENT '创建人ID',
    updated_by VARCHAR(36) COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    
    INDEX idx_applications_user_id (user_id),
    INDEX idx_applications_application_type_id (application_type_id),
    INDEX idx_applications_process_definition_id (process_definition_id),
    INDEX idx_applications_status (status),
    INDEX idx_applications_submitted_at (submitted_at),
    INDEX idx_applications_current_node_id (current_node_id),
    INDEX idx_applications_priority (priority),
    INDEX idx_applications_created_at (created_at),
    FULLTEXT INDEX ft_applications_title_content (title, content),
    
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (application_type_id) REFERENCES application_types(id),
    FOREIGN KEY (process_definition_id) REFERENCES process_definitions(id),
    FOREIGN KEY (current_node_id) REFERENCES process_nodes(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='申请表';
```

#### 4.2.2 申请类型表 (application_types)

```sql
CREATE TABLE application_types (
    id VARCHAR(36) PRIMARY KEY COMMENT '申请类型ID (UUID)',
    type_name VARCHAR(100) NOT NULL UNIQUE COMMENT '类型名称',
    type_code VARCHAR(50) NOT NULL UNIQUE COMMENT '类型编码',
    description VARCHAR(500) COMMENT '类型描述',
    form_config_json JSON COMMENT '表单配置JSON',
    workflow_config_json JSON COMMENT '工作流配置JSON',
    ext_data_json JSON COMMENT '扩展数据JSON',
    is_active BOOLEAN DEFAULT true COMMENT '是否激活',
    created_by VARCHAR(36) COMMENT '创建人ID',
    updated_by VARCHAR(36) COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_application_types_type_name (type_name),
    INDEX idx_application_types_type_code (type_code),
    INDEX idx_application_types_is_active (is_active)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='申请类型表';
```

#### 4.2.3 流程定义表 (process_definitions)

```sql
CREATE TABLE process_definitions (
    id VARCHAR(36) PRIMARY KEY COMMENT '流程定义ID (UUID)',
    process_name VARCHAR(100) NOT NULL COMMENT '流程名称',
    process_code VARCHAR(50) NOT NULL UNIQUE COMMENT '流程编码',
    description VARCHAR(500) COMMENT '流程描述',
    process_config_json JSON COMMENT '流程配置JSON',
    version INT DEFAULT 1 COMMENT '版本号',
    is_active BOOLEAN DEFAULT true COMMENT '是否激活',
    ext_data_json JSON COMMENT '扩展数据JSON',
    created_by VARCHAR(36) COMMENT '创建人ID',
    updated_by VARCHAR(36) COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_process_definitions_process_name (process_name),
    INDEX idx_process_definitions_process_code (process_code),
    INDEX idx_process_definitions_version (version),
    INDEX idx_process_definitions_is_active (is_active)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='流程定义表';
```

#### 4.2.4 流程节点表 (process_nodes)

```sql
CREATE TABLE process_nodes (
    id VARCHAR(36) PRIMARY KEY COMMENT '节点ID (UUID)',
    process_definition_id VARCHAR(36) NOT NULL COMMENT '流程定义ID',
    node_name VARCHAR(100) NOT NULL COMMENT '节点名称',
    node_code VARCHAR(50) COMMENT '节点编码',
    node_type VARCHAR(50) NOT NULL COMMENT '节点类型',
    node_config_json JSON COMMENT '节点配置JSON',
    next_node_id VARCHAR(36) COMMENT '下一个节点ID',
    order_num INT DEFAULT 0 COMMENT '排序号',
    timeout_days INT DEFAULT 0 COMMENT '超时天数',
    is_skipable BOOLEAN DEFAULT false COMMENT '是否可跳过',
    ext_data_json JSON COMMENT '扩展数据JSON',
    created_by VARCHAR(36) COMMENT '创建人ID',
    updated_by VARCHAR(36) COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_process_nodes_process_definition_id (process_definition_id),
    INDEX idx_process_nodes_next_node_id (next_node_id),
    INDEX idx_process_nodes_node_type (node_type),
    INDEX idx_process_nodes_order_num (order_num),
    
    FOREIGN KEY (process_definition_id) REFERENCES process_definitions(id),
    FOREIGN KEY (next_node_id) REFERENCES process_nodes(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='流程节点表';
```

#### 4.2.5 审批表 (approvals)

```sql
CREATE TABLE approvals (
    id VARCHAR(36) PRIMARY KEY COMMENT '审批ID (UUID)',
    application_id VARCHAR(36) NOT NULL COMMENT '申请ID',
    approver_id VARCHAR(36) NOT NULL COMMENT '审批人ID',
    node_id VARCHAR(36) NOT NULL COMMENT '流程节点ID',
    status VARCHAR(50) NOT NULL DEFAULT 'pending' COMMENT '审批状态',
    comment TEXT COMMENT '审批意见',
    approved_at DATETIME COMMENT '审批时间',
    due_at DATETIME COMMENT '截止时间',
    is_transferred BOOLEAN DEFAULT false COMMENT '是否转交',
    intelligent_score DECIMAL(5,2) COMMENT '智能评分',
    ext_data_json JSON COMMENT '扩展数据JSON',
    created_by VARCHAR(36) COMMENT '创建人ID',
    updated_by VARCHAR(36) COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_approvals_application_id (application_id),
    INDEX idx_approvals_approver_id (approver_id),
    INDEX idx_approvals_node_id (node_id),
    INDEX idx_approvals_status (status),
    INDEX idx_approvals_approved_at (approved_at),
    INDEX idx_approvals_due_at (due_at),
    INDEX idx_approvals_created_at (created_at),
    
    FOREIGN KEY (application_id) REFERENCES applications(id),
    FOREIGN KEY (approver_id) REFERENCES users(id),
    FOREIGN KEY (node_id) REFERENCES process_nodes(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='审批表';
```

### 4.3 历史记录模块

#### 4.3.1 申请历史表 (application_histories)

```sql
CREATE TABLE application_histories (
    id VARCHAR(36) PRIMARY KEY COMMENT '历史ID (UUID)',
    application_id VARCHAR(36) NOT NULL COMMENT '申请ID',
    field_name VARCHAR(100) NOT NULL COMMENT '字段名称',
    old_value TEXT COMMENT '旧值',
    new_value TEXT COMMENT '新值',
    action_type VARCHAR(50) NOT NULL COMMENT '操作类型',
    ext_data_json JSON COMMENT '扩展数据JSON',
    changed_by VARCHAR(36) NOT NULL COMMENT '变更人ID',
    changed_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '变更时间',
    created_by VARCHAR(36) COMMENT '创建人ID',
    updated_by VARCHAR(36) COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_application_histories_application_id (application_id),
    INDEX idx_application_histories_field_name (field_name),
    INDEX idx_application_histories_action_type (action_type),
    INDEX idx_application_histories_changed_by (changed_by),
    INDEX idx_application_histories_changed_at (changed_at),
    
    FOREIGN KEY (application_id) REFERENCES applications(id),
    FOREIGN KEY (changed_by) REFERENCES users(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='申请历史表';
```

#### 4.3.2 审批历史表 (approval_histories)

```sql
CREATE TABLE approval_histories (
    id VARCHAR(36) PRIMARY KEY COMMENT '历史ID (UUID)',
    approval_id VARCHAR(36) NOT NULL COMMENT '审批ID',
    action VARCHAR(50) NOT NULL COMMENT '操作动作',
    details TEXT COMMENT '操作详情',
    action_by VARCHAR(36) NOT NULL COMMENT '操作人ID',
    ext_data_json JSON COMMENT '扩展数据JSON',
    action_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '操作时间',
    created_by VARCHAR(36) COMMENT '创建人ID',
    updated_by VARCHAR(36) COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_approval_histories_approval_id (approval_id),
    INDEX idx_approval_histories_action (action),
    INDEX idx_approval_histories_action_by (action_by),
    INDEX idx_approval_histories_action_time (action_time),
    
    FOREIGN KEY (approval_id) REFERENCES approvals(id),
    FOREIGN KEY (action_by) REFERENCES users(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='审批历史表';
```

#### 4.3.3 转交记录表 (transfer_records)

```sql
CREATE TABLE transfer_records (
    id VARCHAR(36) PRIMARY KEY COMMENT '转交记录ID (UUID)',
    approval_id VARCHAR(36) NOT NULL COMMENT '审批ID',
    from_user_id VARCHAR(36) NOT NULL COMMENT '转出人ID',
    to_user_id VARCHAR(36) NOT NULL COMMENT '接收人ID',
    transfer_reason TEXT COMMENT '转交原因',
    transferred_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '转交时间',
    ext_data_json JSON COMMENT '扩展数据JSON',
    created_by VARCHAR(36) COMMENT '创建人ID',
    updated_by VARCHAR(36) COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_transfer_records_approval_id (approval_id),
    INDEX idx_transfer_records_from_user_id (from_user_id),
    INDEX idx_transfer_records_to_user_id (to_user_id),
    INDEX idx_transfer_records_transferred_at (transferred_at),
    
    FOREIGN KEY (approval_id) REFERENCES approvals(id),
    FOREIGN KEY (from_user_id) REFERENCES users(id),
    FOREIGN KEY (to_user_id) REFERENCES users(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='转交记录表';
```

### 4.4 辅助功能模块

#### 4.4.1 附件表 (attachments)

```sql
CREATE TABLE attachments (
    id VARCHAR(36) PRIMARY KEY COMMENT '附件ID (UUID)',
    application_id VARCHAR(36) NOT NULL COMMENT '申请ID',
    file_name VARCHAR(255) NOT NULL COMMENT '文件名称',
    file_path VARCHAR(500) NOT NULL COMMENT '文件路径',
    file_type VARCHAR(100) COMMENT '文件类型',
    file_size BIGINT COMMENT '文件大小（字节）',
    hash_value VARCHAR(64) COMMENT '文件哈希值',
    ext_data_json JSON COMMENT '扩展数据JSON',
    uploaded_by VARCHAR(36) NOT NULL COMMENT '上传人ID',
    uploaded_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '上传时间',
    created_by VARCHAR(36) COMMENT '创建人ID',
    updated_by VARCHAR(36) COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_attachments_application_id (application_id),
    INDEX idx_attachments_uploaded_by (uploaded_by),
    INDEX idx_attachments_file_type (file_type),
    INDEX idx_attachments_uploaded_at (uploaded_at),
    
    FOREIGN KEY (application_id) REFERENCES applications(id),
    FOREIGN KEY (uploaded_by) REFERENCES users(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='附件表';
```

#### 4.4.2 通知表 (notifications)

```sql
CREATE TABLE notifications (
    id VARCHAR(36) PRIMARY KEY COMMENT '通知ID (UUID)',
    user_id VARCHAR(36) NOT NULL COMMENT '用户ID',
    application_id VARCHAR(36) COMMENT '申请ID',
    type VARCHAR(50) NOT NULL COMMENT '通知类型',
    title VARCHAR(200) NOT NULL COMMENT '通知标题',
    content TEXT COMMENT '通知内容',
    is_read BOOLEAN DEFAULT false COMMENT '是否已读',
    read_at DATETIME COMMENT '阅读时间',
    related_id VARCHAR(36) COMMENT '关联ID',
    ext_data_json JSON COMMENT '扩展数据JSON',
    created_by VARCHAR(36) COMMENT '创建人ID',
    updated_by VARCHAR(36) COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_notifications_user_id (user_id),
    INDEX idx_notifications_application_id (application_id),
    INDEX idx_notifications_type (type),
    INDEX idx_notifications_is_read (is_read),
    INDEX idx_notifications_created_at (created_at),
    
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (application_id) REFERENCES applications(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='通知表';
```

#### 4.4.3 资源表 (resources)

```sql
CREATE TABLE resources (
    id VARCHAR(36) PRIMARY KEY COMMENT '资源ID (UUID)',
    dept_id VARCHAR(36) NOT NULL COMMENT '部门ID',
    resource_type VARCHAR(50) NOT NULL COMMENT '资源类型',
    resource_name VARCHAR(100) NOT NULL COMMENT '资源名称',
    quantity INT DEFAULT 0 COMMENT '总数量',
    available_quantity INT DEFAULT 0 COMMENT '可用数量',
    unit VARCHAR(20) COMMENT '单位',
    description VARCHAR(500) COMMENT '资源描述',
    ext_data_json JSON COMMENT '扩展数据JSON',
    is_active BOOLEAN DEFAULT true COMMENT '是否激活',
    created_by VARCHAR(36) COMMENT '创建人ID',
    updated_by VARCHAR(36) COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_resources_dept_id (dept_id),
    INDEX idx_resources_resource_type (resource_type),
    INDEX idx_resources_resource_name (resource_name),
    INDEX idx_resources_is_active (is_active),
    
    FOREIGN KEY (dept_id) REFERENCES departments(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='资源表';
```

#### 4.4.4 智能初审表 (intelligent_reviews)

```sql
CREATE TABLE intelligent_reviews (
    id VARCHAR(36) PRIMARY KEY COMMENT '初审ID (UUID)',
    application_id VARCHAR(36) NOT NULL UNIQUE COMMENT '申请ID',
    extracted_info_json JSON COMMENT '提取信息JSON',
    is_compliant BOOLEAN COMMENT '是否合规',
    compliance_issues TEXT COMMENT '合规问题',
    approval_suggestion TEXT COMMENT '审批建议',
    confidence_score DECIMAL(5,2) COMMENT '置信度评分',
    processing_time_ms INT COMMENT '处理时间（毫秒）',
    ext_data_json JSON COMMENT '扩展数据JSON',
    reviewed_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '初审时间',
    created_by VARCHAR(36) COMMENT '创建人ID',
    updated_by VARCHAR(36) COMMENT '更新人ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_intelligent_reviews_application_id (application_id),
    INDEX idx_intelligent_reviews_is_compliant (is_compliant),
    INDEX idx_intelligent_reviews_confidence_score (confidence_score),
    INDEX idx_intelligent_reviews_reviewed_at (reviewed_at),
    
    FOREIGN KEY (application_id) REFERENCES applications(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='智能初审表';
```

## 5. 索引设计策略

### 5.1 索引设计原则

1. **主键索引**：所有表的主键自动创建聚簇索引
2. **外键索引**：所有外键字段自动创建索引，优化关联查询
3. **查询优化**：根据业务查询需求，为常用查询条件创建索引
4. **唯一约束**：为需要唯一性的字段创建唯一索引
5. **复合索引**：为多条件查询创建复合索引，注意字段顺序

### 5.2 性能优化索引

#### 5.2.1 高频查询索引
```sql
-- 申请列表查询优化
CREATE INDEX idx_applications_user_status ON applications(user_id, status);
CREATE INDEX idx_applications_type_status ON applications(application_type_id, status);
CREATE INDEX idx_applications_submitted_status ON applications(submitted_at, status);

-- 审批任务查询优化
CREATE INDEX idx_approvals_approver_status ON approvals(approver_id, status);
CREATE INDEX idx_approvals_due_status ON approvals(due_at, status);

-- 通知查询优化
CREATE INDEX idx_notifications_user_read ON notifications(user_id, is_read);
```

#### 5.2.2 全文搜索索引
```sql
-- 申请内容搜索
CREATE FULLTEXT INDEX ft_applications_search ON applications(title, content);

-- 审批意见搜索
CREATE FULLTEXT INDEX ft_approvals_search ON approvals(comment);
```

## 6. 数据完整性约束

### 6.1 外键约束
- 所有外键关系都设置了外键约束，确保数据引用的完整性
- 关联表使用级联删除，如user_roles、role_permissions等
- 业务数据表使用限制删除，防止误删除重要数据

### 6.2 唯一约束
- 用户表：username、email字段设置唯一约束
- 角色表：role_name、role_code字段设置唯一约束
- 权限表：permission_name、permission_code字段设置唯一约束
- 部门表：dept_code字段设置唯一约束
- 申请类型表：type_name、type_code字段设置唯一约束
- 流程定义表：process_code字段设置唯一约束
- 智能初审表：application_id字段设置唯一约束

### 6.3 非空约束
- 关键业务字段设置NOT NULL约束，确保数据完整性
- 状态字段设置默认值，确保业务状态的正确性
- 时间戳字段设置默认值，确保审计信息的完整性

## 7. 扩展性设计

### 7.1 JSON扩展字段
所有主要表都包含ext_data_json字段，支持以下扩展场景：
- **动态字段**：无需修改表结构即可添加新字段
- **配置信息**：存储业务配置和参数
- **临时数据**：存储计算过程中的临时数据
- **第三方集成**：存储外部系统的数据映射

### 7.2 模块化设计
- **用户权限模块**：独立的用户、角色、权限管理
- **申请流程模块**：独立的申请、审批、流程管理
- **历史记录模块**：独立的历史数据记录和审计
- **辅助功能模块**：通知、附件、资源等辅助功能

### 7.3 版本管理
- 流程定义表包含version字段，支持流程版本管理
- 历史记录表完整记录数据变更历史
- 时间戳字段支持数据的时间维度分析

## 8. 性能优化考虑

### 8.1 数据类型优化
- 使用合适的数据类型，如DECIMAL处理金额、JSON存储结构化数据
- 字符串字段根据实际需求设置合理的长度
- 时间字段使用DATETIME类型，支持毫秒级精度

### 8.2 索引优化
- 为所有外键字段创建索引
- 为常用查询条件创建复合索引
- 为文本搜索字段创建全文索引
- 定期分析和优化索引使用情况

### 8.3 查询优化
- 避免N+1查询问题，使用JOIN和预加载
- 使用分页查询处理大量数据
- 使用覆盖索引减少回表查询
- 合理使用缓存减少数据库压力

### 8.4 数据归档策略
- 历史数据定期归档，保持活跃数据集的性能
- 大表分区策略，按时间或业务维度分区
- 冷热数据分离，不同存储介质存储

## 9. 安全性设计

### 9.1 数据加密
- 敏感字段如password_hash使用高强度加密
- 支持字段级加密，如手机号、邮箱等个人信息
- 支持传输层加密，确保数据传输安全

### 9.2 访问控制
- 基于角色的访问控制（RBAC）模型
- 支持行级安全（RLS）控制
- 支持数据脱敏和访问审计

### 9.3 备份策略
- 定期全量备份和增量备份
- 支持点时间恢复（PITR）
- 异地备份和容灾策略

本数据库设计为FlowMind智能审批系统提供了完整、灵活、可扩展的数据存储方案，能够支撑系统的核心业务功能，同时为未来的业务发展和技术演进预留了充分的扩展空间。