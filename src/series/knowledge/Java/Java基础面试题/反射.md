---
order: 6
---
# 反射
## 什么是反射？
Java反射机制是**运行时动态获取类信息、操作对象成员**的能力：
- 对任意类，能获取其所有属性、方法、构造器等结构信息。
- 对任意对象，能调用其任意方法（包括私有方法）、访问/修改其任意字段（包括私有字段）。

（此处应有"Java反射获取类信息流程"的示意图，图片名称：Java反射机制示意图）

### 反射的核心特性
1. **运行时类信息访问**：无需编译时知道类名，即可在运行时获取类的包名、父类、接口、成员等信息。
2. **动态对象创建**：通过`Class.newInstance()`或`Constructor.newInstance()`，运行时动态创建对象（无需`new`关键字）。
3. **动态方法调用**：通过`Method.invoke()`，运行时调用对象的方法（包括私有方法）。
4. **字段访问与修改**：通过`Field.get()`/`Field.set()`，运行时访问/修改对象的字段（包括私有字段）。

## 反射在你平时写代码或者框架中的应用场景有哪些?
反射在框架开发和动态编程中应用广泛，常见场景如下：

### 1. 加载数据库驱动（JDBC）
JDBC通过反射动态加载不同数据库的驱动类，无需硬编码驱动实现，适配多数据库。
```java
// 传统硬编码（不推荐）
// DriverManager.registerDriver(new com.mysql.cj.jdbc.Driver());

// 反射加载（灵活适配mysql/oracle）
Class.forName("com.mysql.cj.jdbc.Driver"); // 加载mysql驱动
// Class.forName("oracle.jdbc.driver.OracleDriver"); // 加载oracle驱动
```

### 2. 框架的IOC容器（如Spring）
Spring的IOC（控制反转）通过反射动态加载和管理Bean：
1. 加载XML/properties配置文件，解析出Bean的类名和属性。
2. 用反射（`Class.forName()`）获取Bean的`Class`实例，创建对象。
3. 用反射（`Field.set()`）动态设置Bean的属性值。

示例流程：
- 配置文件（application.properties）：
  ```properties
  className=com.example.reflectdemo.TestInvoke
  methodName=printlnState
  ```
- 实体类：
  ```java
  public class TestInvoke {
      private void printlnState(){
          System.out.println("I am fine");
      }
  }
  ```
- 反射加载并调用方法：
  ```java
  import java.io.FileInputStream;
  import java.lang.reflect.Method;
  import java.util.Properties;

  public class Main {
      // 解析配置文件
      public static String getName(String key) throws Exception {
          Properties props = new Properties();
          props.load(new FileInputStream("application.properties"));
          return props.getProperty(key);
      }

      public static void main(String[] args) throws Exception {
          // 1. 反射获取Class对象
          Class<?> clazz = Class.forName(getName("className"));
          // 2. 获取私有方法（getDeclaredMethod()获取私有方法）
          Method method = clazz.getDeclaredMethod(getName("methodName"));
          method.setAccessible(true); // 绕过私有限制
          // 3. 反射创建实例
          Object obj = clazz.newInstance();
          // 4. 反射调用方法
          method.invoke(obj); // 输出：I am fine
      }
  }
  ```